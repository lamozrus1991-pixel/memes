# KODA.md — Инструкции для работы с проектом

## Обзор проекта

**Тип проекта:** Веб-приложение (Flask/Python)

**Назначение:** Простой блог с системой регистрации и авторизации пользователей, лентой новостей и возможностью создания, редактирования и удаления постов.

**Технологический стек:**
- **Backend:** Flask (Python)
- **База данных:** SQLite (через Flask-SQLAlchemy)
- **Аутентификация:** Flask-Login
- **Хеширование паролей:** Werkzeug (pbkdf2:sha256)
- **Frontend:** HTML-шаблоны с Jinja2, Bootstrap 5

---

## Архитектура проекта

### Структура файлов

```
├── app.py                    # Основное приложение Flask
├── requirements.txt          # Зависимости Python
├── instance/
│   └── blog.db              # SQLite база данных (создаётся автоматически)
├── static/
│   └── uploads/avatars      # Загруженные аватарки пользователей
└── templates/
    ├── base.html            # Базовый шаблон с навигацией
    ├── index.html           # Главная страница — лента новостей
    ├── login.html           # Страница входа
    ├── register.html        # Страница регистрации
    ├── create_post.html     # Страница создания поста
    ├── edit_post.html       # Страница редактирования поста
    ├── profile.html         # Страница просмотра профиля
    └── edit_profile.html    # Страница редактирования профиля
```

### Модели данных

**User (Пользователь):**
- `id` — первичный ключ
- `username` — уникальное имя пользователя
- `email` — email (необязательное)
- `password` — хешированный пароль
- `avatar` — путь к файлу аватарки
- `posts` — связь с постами пользователя

**Post (Пост):**
- `id` — первичный ключ
- `title` — заголовок поста
- `content` — содержание поста
- `image` — путь к изображению (необязательное)
- `date_posted` — дата создания (автоматически)
- `user_id` — внешний ключ на пользователя
- `comments` — связь с комментариями

**Comment (Комментарий):**
- `id` — первичный ключ
- `content` — текст комментария
- `date_created` — дата создания
- `user_id` — автор комментария
- `post_id` — пост, к которому относится комментарий

---

## Сборка и запуск

### Установка зависимостей

```bash
pip install -r requirements.txt
```

### Запуск приложения

```bash
python3 app.py
```

Приложение будет доступно по адресу: `http://127.0.0.1:5000`

### База данных

- Автоматически создаётся при первом запуске в директории `instance/blog.db`
- При удалении файла базы данных она будет пересоздана при следующем запуске

---

## Маршруты приложения

| Маршрут | Метод | Описание | Доступ |
|---------|-------|----------|--------|
| `/` | GET | Лента новостей | Все |
| `/register` | GET/POST | Регистрация | Все |
| `/login` | GET/POST | Вход | Все |
| `/logout` | GET | Выход | Авторизованные |
| `/create` | GET/POST | Создание поста | Авторизованные |
| `/edit/<int:post_id>` | GET/POST | Редактирование поста | Авторизованные (автор поста) |
| `/delete/<int:post_id>` | POST | Удаление поста | Авторизованные (автор поста) |
| `/profile/<username>` | GET | Просмотр профиля пользователя | Все |
| `/profile` | GET/POST | Мой профиль (редактирование) | Авторизованные |
| `/post/<int:post_id>/comment` | POST | Добавить комментарий | Авторизованные |
| `/comment/<int:comment_id>/delete` | POST | Удалить комментарий | Авторизованные (автор комментария или поста) |

---

## Правила разработки

### Стиль кода

- **Язык комментариев:** Русский (как в текущем коде)
- **Форматирование:** Стандартное форматирование Python
- **Именование:** snake_case для переменных и функций
- **Шаблоны:** Jinja2 с использованием наследования от base.html

### Безопасность

- Пароли хешируются с использованием `pbkdf2:sha256`
- Используется `werkzeug.security` для работы с паролями
- Маршруты, требующие авторизации, защищены декоратором `@login_required`
- Проверка авторства поста перед редактированием/удалением

### Frontend

- Bootstrap 5 для стилизации (подключается через CDN)
- SVG-иконки для кнопок показа/скрытия пароля
- Flash-сообщения для уведомлений пользователя
- Кнопки редактирования и удаления отображаются только автору поста

---

## Текущее состояние

### Реализованный функционал

- Регистрация пользователей с проверкой уникальности имени
- Авторизация с хешированием паролей
- Лента новостей с сортировкой по дате (новые сверху)
- Создание постов (только для авторизованных пользователей)
- Редактирование своих постов
- Удаление своих постов
- Система комментариев к постам
- Отображение автора и даты создания поста
- Показ/скрытие пароля в формах ввода
- Профили пользователей со статистикой постов
- Загрузка аватарки для профиля

### Особенности реализации

- Поле подтверждения пароля при регистрации
- Кнопки с иконкой «глаз» для показа пароля в формах
- Flash-сообщения для ошибок и уведомлений
- Навигационное меню адаптируется под статус авторизации
- Подтверждение перед удалением поста

---

## Развитие проекта

При расширении функционала рекомендуется:

1. Реализовать пагинацию для ленты новостей
2. Реализовать сброс/восстановление пароля